---
name: $(Date:yyyy-MM-dd HHmmss) $(SourceBranchName)

resources:
  repositories:
    - repository: templates
      type: git
      name: tmnl\azurepipelinestemplates
      
variables:
  - group: FU1.Azure.Generic

pool: $(WindowsPool)

jobs:
  - job:
    displayName: Build Orchestration.FrontEnd
    steps:
      - template: jobs\build\dotnet-core-build-and-publish-artifact.yml@templates
        parameters:
          sonarQubeProject: tmnl-Orchestration.FrontEnd
          solution: .\Orchestration.FrontEnd.sln
          restoreVstsFeed: adf0bede-9797-486b-a898-ee140def04ea/2b55806f-5afc-4773-9d7f-07909f2d2fe1
          nexusIqApplicationId: TMNL-Orchestration.FrontEnd
          projects: .\Orchestrator.FrontEnd\Orchestrator.Frontend.csproj
          publishArguments: --output $(Build.ArtifactStagingDirectory)
          artifactName: Orchestration.FrontEnd
          pathToPublish: $(Build.ArtifactStagingDirectory)
          publishWebProjects: true
          testArguments: --logger trx --collect "Code Coverage" --filter "TestCategory!=Integration"

  - job:
    displayName: Build Orchestration.FrontEnd.DatabaseConnection
    steps:
      - template: jobs\build\dotnet-core-build-and-publish-artifact.yml@templates
        parameters:
          sonarQubeProject: tmnl-Orchestration.FrontEnd
          solution: .\Orchestration.FrontEnd.sln
          restoreVstsFeed: adf0bede-9797-486b-a898-ee140def04ea/2b55806f-5afc-4773-9d7f-07909f2d2fe1
          nexusIqApplicationId: TMNL-Orchestration.FrontEnd
          projects: .\Orchestration.FrontEnd.DatabaseConnection\Orchestration.FrontEnd.DatabaseConnection.csproj
          publishArguments: --output $(Build.ArtifactStagingDirectory)
          artifactName: Orchestration.FrontEnd.DatabaseConnection
          pathToPublish: $(Build.ArtifactStagingDirectory)
          testArguments: --logger trx --collect "Code Coverage" --filter "TestCategory!=Integration"

  - job:
    displayName: Run Credential Scanner
    steps:
      - template: jobs\build\credential-scanner.yml@templates

  - job:
    displayName: Run Fortify Static Code Analyzer Assessment
    steps:
      - template: jobs\build\fortify-static-code-analyzer-assessment.yml@templates
        parameters:
          fortifyApplicationName: TMNL-Orchestration.FrontEnd
